#1.Query_cache::store_query

```cpp
Query_cache::store_query
--Query_cache::is_cacheable
----Query_cache::process_and_count_tables
------*tables_type|= tables_used->table->file->table_cache_type();
--ha_release_temporary_latches
--try_lock
--Query_cache::ask_handler_allowance
----ha_innobase::register_query_cache_table
------innobase_query_caching_of_table_permitted
--------normalize_table_name
--------innobase_register_trx
----------trans_register_ha
----------trx_is_registered_for_2pc
----------trx_register_for_2pc
--------row_search_check_if_query_cache_permitted
----------table = dict_table_open_on_name
----------trx_start_if_not_started
------------trx_start_if_not_started_low
--------------trx_start_low
----------MVCC::view_open
----------dict_table_close
--make_cache_key
--Query_cache_block *competitor = (Query_cache_block *)my_hash_search(&queries, (uchar*) cache_key, tot_length)
--if (competitor == 0)
----Query_cache::write_block_data
------all_headers_len = sizeof(Query_cache_block) + ntab*sizeof(Query_cache_block_table) + header_len
------Query_cache::allocate_block
--------Query_cache::get_free_block
----------Query_cache::find_bin
----------Query_cache::exclude_from_free_memory_list
------------Query_cache_block::data
--------------Query_cache_block::headers_len
------------Query_cache::double_linked_list_exclude
------------bin->number--
------------free_memory-=free_block->length;
------------free_memory_blocks--
--------if (block->length >= ALIGN_SIZE(len) + min_allocation_unit)
----------Query_cache::split_block
------------new_block = (Query_cache_block*)(((uchar*) block)+len)
------------Query_cache_block::init
------------new_block->pnext = block->pnext
------------block->pnext = new_block
------------new_block->pnext->pprev = new_block;
------------if (block->type == Query_cache_block::FREE)
--------------Query_cache::insert_into_free_memory_list
----------------Query_cache::find_bin
----------------Query_cache::insert_into_free_memory_sorted_list
```