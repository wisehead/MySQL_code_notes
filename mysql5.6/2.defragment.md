# 一、btr
## 1.btr_defragment_add_index


	btr_defragment_add_index
	--btr_pcur_create_for_mysql
	--os_event_create
	--btr_pcur_open_at_index_side
	----btr_pcur_init
	----btr_cur_open_at_index_side_func
	------mtr_set_savepoint
	--btr_pcur_move_to_next
	----btr_pcur_move_to_next_on_page
	------page_cur_move_to_next
	--------page_rec_get_next
	----------page_rec_get_next_low
	------------rec_get_next_offs//?????
	--btr_pcur_store_position
	----dict_index_copy_rec_order_prefix//???????


caller:

	* -btr_gen_defragment_item_for_table
	* -ha_innobase::defragment_table
	* -test_btr_gen_defragment_item_for_table



## 2.btr-defragment-remove-table

## 3.btr_defragment_remove_index

## 4.btr_defragment_remove_item

## 5.btr_defragment_save_defrag_stats_if_needed

	btr_defragment_save_defrag_stats_if_needed
	--dict_stats_defrag_pool_add
	----os_event_set(dict_stats_event)
	------os_cond_broadcast
	
	DECLARE_THREAD(dict_stats_thread) is waiting for the dict_stats_event, learn how to use event.
	        os_event_wait_time(
	            dict_stats_event, MIN_RECALC_INTERVAL * 1000000);  
            
## 6.btr_defragment_calc_n_recs_for_size

	btr_defragment_calc_n_recs_for_size
	--page_cur_set_before_first
	--page_cur_move_to_next
	--page_cur_get_rec
	--rec_get_offsets

caller:

-btr_defragment_merge_pages


## 7.btr_defragment_merge_pages

	btr_defragment_merge_pages
	--page_get_n_recs
	--page_get_data_size
	--page_get_max_insert_size
	----page_dir_calc_reserved_space


# 二、purge出core的stack

	0-  pthread_kill 
	1-  handle_fatal_signal 
	2-  <signal handler called>
	3-  mach_read_from_2 
	4-  page_dir_slot_get_rec 
	5-  page_cur_search_with_match ()
	6-  btr_cur_search_to_nth_level 
	7-  btr_pcur_open_with_no_init_func
	8-  btr_pcur_restore_position_func 
	9-  row_purge_reposition_pcur
	10- row_purge_remove_clust_if_poss_low 
	11- row_purge_remove_clust_if_poss 
	12- row_purge_del_mark 
	13- row_purge_record_func
	14- row_purge 
	15- row_purge_step
	16- que_thr_step 
	17- que_run_threads_low
	18- que_run_threads
	19- srv_task_execute 
	20- srv_worker_thread 
	21- start_thread 
	22-clone () 
	(gdb)








































